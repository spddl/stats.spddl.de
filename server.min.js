function readApi(){console.log("     readApi()"),clientjson.get("ICSGOServers_730/GetGameServersStatus/v001/?key="+steamapikey,function(a,b,c){console.log("err "+a),void 0!==c?(console.log("  API Daten gefunden".yellow),jf.readFile(Steamapi_FILE,"utf8",function(a,b){b.app.timestamp==c.result.app.timestamp?(console.log("Alte Daten! ".green+b.app.timestamp+" | "+c.result.app.timestamp),waitsec(2e3)):(console.log("Neue Daten! ".red+"alt: "+b.app.timestamp+" | neu: "+c.result.app.timestamp),io.sockets.emit("Steamapi",c.result),waitsec(45e3),saveDB(c.result))})):(console.log("  API Daten nicht gefunden".red),jf.readFile(apiDown_FILE,"utf8",function(a,b){io.sockets.emit("Steamapi",b)}),waitsec(5e3))})}function saveDB(a){console.log("     saveDB() "+Date()),process.nextTick(function(){jf.writeFileSync(Steamapi_FILE,a)})}function waitsec(a){setTimeout(function(){console.log("wait "+a/1e3+"sek! ".red+Date()),readApi()},a)}var ipaddress=process.env.OPENSHIFT_NODEJS_IP||"127.0.0.1",port=process.env.OPENSHIFT_NODEJS_PORT||80,jf=require("jsonfile"),requestjson=require("request-json"),connect=require("connect"),colors=require("colors"),serveStatic=require("serve-static"),socket=require("socket.io"),util=require("util"),Steamapi_FILEcache=require("./resources/steamapi.json"),Steamapi_FILE="./resources/steamapi.json",apiDown_FILE="./resources/down.json",server=connect().use(serveStatic(__dirname+"/client")).listen(port,ipaddress),io=socket.listen(server),steamapikey="C1A60EF0448304A573E521E54F0F2582",clientjson=requestjson.createClient("http://api.steampowered.com/");io.sockets.on("connection",function(a){console.log("client connected!"),jf.readFile(Steamapi_FILE,"utf8",function(b,c){a.emit("Steamapi",c)}),a.on("uptime",function(){a.emit("uptime",process.uptime()),console.log(process.uptime())}),a.on("memoryUsage",function(){a.emit("memoryUsage",util.inspect(process.memoryUsage()))})}),readApi(),console.log("Server started and listen to http://"+ipaddress+":"+port);